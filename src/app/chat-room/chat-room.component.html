<p-toast />
<app-header></app-header>
<!-- <p-tabMenu [model]="items" [activeItem]="activeItem" (activeItemChange)="onActiveItemChange($event)"/> -->
<!-- ##{{activeItem | json}} -->

  <div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="btn-group w-100 tabs-nav">
                <button class="btn btn-primary active" (click)="getChatRoomList('CHAT', 0)">Chat</button>
                <button class="btn btn-primary" (click)="getChatRoomList('GROUP', 1)">Group Outlay</button>
                <button class="btn btn-primary active" (click)="getChatRoomList('SELF', 2)">Self Outlay</button>
            </div>
        </div>
    </div>

    <!-- Chat Tab -->
    <div class="tab-content chat-tab" id="chatTab" style="display: block;">
        <div class="row chat-container">
            <!-- Left: Member List -->
            <div class="member-list">
                <p-table 
                    [value]="chatRoomList" 
                    [scrollable]="true" 
                    scrollHeight="400px" 
                    [lazy]="true" 
                    (onLazyLoad)="getChatRoomList(activeTab==0 ? 'CHAT': activeTab==1 ? 'GROUP' : 'SELF')"
                    [styleClass]="'chat-table'"
                    [tableStyle]="{ 'width': '100%' }">
                    
                    <!-- <ng-template pTemplate="header">
                        <tr>
                        <th>Member Name</th>
                        <th>Status</th>
                        </tr>
                    </ng-template> -->
                    
                    <ng-template pTemplate="body" let-roomRow let-rowIndex="rowIndex">
                        <tr 
                        [ngClass]="{'highlighted-row': selectedRow === rowIndex}" 
                        (click)="selectMember(roomRow, rowIndex)">
                        <td>{{ roomRow.roomName }}</td>
                        </tr>
                    </ng-template>

                </p-table>

            </div>

            <!-- Right: Chat Room -->
            <div class="chat-room">
                <div class="chat-header" id="chatHeader">
                    Chat with: {{selectedRoom.roomName}}
                </div>

                <div class="chat-area" id="chatArea">
                    <div cdkScrollable #chatWindow class="chat-window" (scroll)="onScroll($event)">
                        <ng-container *ngFor="let msg of messages">
                            <div [class]="msg.sender == message.sender ? 'message sent' : 'message'">
                                <!-- <div class="message-header">
                                  <span class="username">{{ msg.sender }}</span>
                                  <span class="timestamp">{{ msg?.time }}</span>
                                  </div> -->
                                  {{ msg.content }}
                            </div>   
                        </ng-container>
                    </div>
                </div>

                <!-- Input Area at the bottom -->
                <div class="input-area">
                    <input type="text" id="messageInput" placeholder="Type a message..." [(ngModel)]="message.content" (keydown.enter)="sendMessage()"/>
                    <button [disabled]="!selectedRoom || !message.content || !message.sender" (click)="sendMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Calculation Tab -->
    <div class="tab-content calculation-tab" id="calculationTab" style="display: none;">
        <div class="chat-room">
            <div class="chat-header">Calculation</div>
            <div class="chat-area">
                <p>Results or inputs related to calculations will be shown here.</p>
            </div>
            <div class="input-area">
                <input type="text" placeholder="Enter calculation..." />
                <button>Calculate</button>
            </div>
        </div>
    </div>
</div>

